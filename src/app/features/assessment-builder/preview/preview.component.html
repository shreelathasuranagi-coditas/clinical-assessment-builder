<div class="preview-container">
  <mat-toolbar color="primary">
    <button mat-icon-button (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
    <span class="spacer"></span>
    <h2>Preview Mode</h2>
    <span class="spacer"></span>
    <span class="step-indicator">
      {{ currentStep() + 1 }} / {{ visibleQuestions().length }}
    </span>
  </mat-toolbar>

  <div class="preview-content">
    <div class="question-container">
      @if (assessment() && currentQuestion()) {
        <mat-card class="question-card">
          <mat-card-header>
            <mat-card-title>{{ getQuestionDisplay(currentQuestion()!) }}</mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <form [formGroup]="form">
              @switch (currentQuestion()!.type) {
                @case ('single_choice') {
                  <mat-radio-group formControlName="answer" class="radio-group">
                    @for (option of currentQuestion()!.options; track option.id) {
                      <mat-radio-button [value]="option.text" class="radio-button">
                        {{ option.text }}
                      </mat-radio-button>
                    }
                  </mat-radio-group>
                }
                @case ('multi_choice') {
                  <div class="checkbox-group">
                    @for (option of currentQuestion()!.options; track option.id) {
                      <mat-checkbox [value]="option.text" class="checkbox">
                        {{ option.text }}
                      </mat-checkbox>
                    }
                  </div>
                }
                @case ('short_text') {
                  <mat-form-field appearance="fill" class="full-width">
                    <mat-label>Your answer</mat-label>
                    <input matInput formControlName="answer" />
                  </mat-form-field>
                }
              }
            </form>
          </mat-card-content>

          <mat-card-actions>
            <button
              mat-button
              (click)="back()"
              [disabled]="isFirstQuestion()"
              class="action-btn"
            >
              <mat-icon>arrow_back</mat-icon>
              Back
            </button>
            <span class="spacer"></span>
            <button
              mat-raised-button
              color="primary"
              (click)="next()"
              class="action-btn"
            >
              @if (isLastQuestion()) {
                <span>Complete</span>
                <mat-icon>check</mat-icon>
              } @else {
                <span>Next</span>
                <mat-icon>arrow_forward</mat-icon>
              }
            </button>
          </mat-card-actions>
        </mat-card>
      } @else if (assessment()) {
        <mat-card class="completed-card">
          <mat-card-content>
            <div class="completed-message">
              <mat-icon>check_circle</mat-icon>
              <h2>Assessment Complete!</h2>
              <p>Thank you for completing the assessment.</p>
              <button mat-raised-button color="primary" (click)="close()">
                Back to Editor
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      }
    </div>
  </div>
</div>
