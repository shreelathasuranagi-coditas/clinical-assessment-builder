<div class="editor-container">

  <h3>Edit Question</h3>

  <!-- SCROLLABLE CONTENT -->
  <div class="editor-content">
    <form [formGroup]="form" class="editor-form">

      <!-- Question Text -->
      <app-custom-input
        placeholder="Question Text"
        formControlName="text">
      </app-custom-input>

      <mat-error *ngIf="form.get('text')?.hasError('required') && form.get('text')?.touched">
        Question text is required
      </mat-error>

      <!-- Question Type -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Question Type</mat-label>
        <mat-select formControlName="type" (selectionChange)="onTypeChange()">
          @for (type of questionTypes; track type) {
            <mat-option [value]="type">{{ type | titlecase }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Required Toggle -->
      <div class="toggle-container">
        <mat-slide-toggle formControlName="required">
          Required
        </mat-slide-toggle>
        <span class="help-text">Mark this question as mandatory</span>
      </div>

      <!-- Options -->
      @if (isChoiceType) {
        <mat-card class="options-section">

          <mat-card-header>
            <mat-card-title>Answer Options</mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <div formArrayName="options" class="options-list">

              @if (optionsArray.length === 0) {
                <p class="no-options">No options yet. Add one to get started.</p>
              } @else {
                @for (option of optionsArray.controls; track option; let idx = $index) {
                  <div [formGroupName]="idx" class="option-item">

                    <app-custom-input
                      [placeholder]="'Option ' + (idx + 1)"
                      formControlName="text">
                    </app-custom-input>

                    <button
                      mat-icon-button
                      matTooltip="Remove option"
                      (click)="removeOption(idx)"
                      class="remove-option-btn">
                      <mat-icon>delete</mat-icon>
                    </button>

                  </div>
                }
              }
            </div>

            <app-button (clicked)="addOption()">
              <mat-icon>add</mat-icon>
              Add Option
            </app-button>
          </mat-card-content>
        </mat-card>
      }

      <!-- Conditional Rule -->
      <mat-expansion-panel class="conditional-section">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>rule</mat-icon>
            Conditional Display Logic
          </mat-panel-title>
        </mat-expansion-panel-header>

        <app-condition-rule-editor
          [assessmentId]="assessmentId"
          [currentQuestion]="currentQuestion"
          (ruleChanged)="onConditionalRuleChange()">
        </app-condition-rule-editor>
      </mat-expansion-panel>

    </form>
  </div>

  <!-- FIXED ACTIONS -->
  <div class="editor-actions">
    <app-button
      [primary]="true"
      [disabled]="form.invalid"
      (clicked)="save()">
      Save Question
    </app-button>
  </div>

</div>
